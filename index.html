<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilingual Quiz & Puzzle Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #1D2142;
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .page {
            display: none;
            width: 100%;
            min-height: 100vh;
            padding: 20px;
        }

        .page.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Intro Page Styles */
        .logo-container {
            margin-bottom: 30px;
            text-align: center;
        }

        .logo-placeholder {
            width: 120px;
            height: 80px;
            border: 2px dashed #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            border-radius: 8px;
        }

        .game-title {
            font-size: 48px;
            font-weight: bold;
            margin-bottom: 40px;
            text-align: center;
        }

        .arabic-title {
            font-size: 56px;
            margin-bottom: 10px;
        }

        .input-section {
            margin-bottom: 30px;
            text-align: center;
        }

        .input-label {
            font-size: 18px;
            margin-bottom: 15px;
            display: block;
        }

        .code-input {
            width: 300px;
            height: 50px;
            font-size: 24px;
            text-align: center;
            border: none;
            border-radius: 8px;
            background-color: white;
            color: #1D2142;
            margin-bottom: 20px;
        }

        .continue-btn {
            background: linear-gradient(135deg, #e67e22, #d35400);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .continue-btn:hover {
            transform: scale(1.05);
        }

        .notes {
            text-align: center;
            margin-top: 30px;
        }

        .good-luck {
            font-size: 20px;
            margin-bottom: 20px;
            color: #2ecc71;
        }

        .timing-note {
            font-size: 16px;
            max-width: 600px;
            line-height: 1.4;
        }

        /* Game Page Styles */
        .game-container {
            display: flex;
            width: 100%;
            max-width: 1400px;
            gap: 20px;
        }

        .sidebar {
            width: 200px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            height: fit-content;
        }

        .player-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .current-player {
            background: linear-gradient(135deg, #3498db, #2980b9);
            margin-bottom: 20px;
        }

        .other-players .player-avatar {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        }

        .game-area {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .player-stats {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            color: #3498db;
        }

        .stat-label {
            font-size: 14px;
            margin-top: 5px;
        }

        .challenges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .challenge-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: transform 0.2s, background-color 0.2s;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .challenge-card:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.15);
        }

        .challenge-card.completed {
            background: rgba(46, 204, 113, 0.2);
            border-color: #2ecc71;
        }

        .challenge-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #3498db;
        }

        .challenge-question {
            font-size: 16px;
            margin-bottom: 20px;
            line-height: 1.4;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .option:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .option.selected {
            background: #3498db;
        }

        .math-input {
            width: 100px;
            height: 40px;
            font-size: 18px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin: 0 10px;
        }

        .maze-container {
            display: grid;
            grid-template-columns: repeat(5, 40px);
            grid-template-rows: repeat(5, 40px);
            gap: 2px;
            justify-content: center;
            margin: 20px 0;
        }

        .maze-cell {
            width: 40px;
            height: 40px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        .maze-cell.wall {
            background: #34495e;
            cursor: not-allowed;
        }

        .maze-cell.path {
            background: rgba(255, 255, 255, 0.1);
        }

        .maze-cell.start {
            background: #2ecc71;
        }

        .maze-cell.end {
            background: #e74c3c;
        }

        .maze-cell.selected {
            background: #f39c12;
        }

        .submit-btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
        }

        .finish-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            align-self: center;
        }

        /* Results Page Styles */
        .results-container {
            width: 100%;
            max-width: 1000px;
            text-align: center;
        }

        .results-title {
            font-size: 36px;
            margin-bottom: 30px;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .result-card.winner {
            background: linear-gradient(135deg, #f1c40f, #f39c12);
            color: #1D2142;
        }

        .result-card.current-player {
            border: 3px solid #3498db;
        }

        .result-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .result-info {
            flex: 1;
            text-align: right;
        }

        .result-name {
            font-size: 18px;
            font-weight: bold;
        }

        .result-stats {
            font-size: 14px;
            margin-top: 5px;
        }

        .final-note {
            font-size: 16px;
            margin-top: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .timer-expired {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 18px;
        }

        @media (max-width: 768px) {
            .game-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                display: flex;
                gap: 10px;
                overflow-x: auto;
                padding: 15px;
            }
            
            .player-avatar {
                flex-shrink: 0;
                margin-bottom: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Intro Page -->
    <div class="page active" id="introPage">
        <div class="logo-container">
            <!-- NOTE: Add your SVG logo here, replace the placeholder div -->
            <div class="logo-placeholder">LOGO HERE</div>
        </div>
        
        <h1 class="game-title">
            <div class="arabic-title">اسم اللعبة</div>
            <div>Game Name</div>
        </h1>
        
        <div class="input-section">
            <label class="input-label">
                أدخل الكود الخاص بك / Enter Your Code
            </label>
            <input type="text" class="code-input" id="playerCode" maxlength="4" placeholder="0000">
            <br>
            <button class="continue-btn" onclick="startGame()">
                المتابعة / continue
            </button>
        </div>
        
        <div class="notes">
            <div class="good-luck">حظاً موفقاً / GOOD LUCK!</div>
            <div class="timing-note">
                التوقيت مهم! تأكد من أن تنتهي بأسرع وقت ممكن!<br>
                Timing is Important! Make sure to finish as fast as possible!
            </div>
        </div>
    </div>

    <!-- Game Page -->
    <div class="page" id="gamePage">
        <div class="game-container">
            <div class="sidebar">
                <div class="current-player">
                    <div class="player-avatar" id="currentPlayerAvatar">😊</div>
                </div>
                <div class="other-players" id="otherPlayers">
                    <!-- Other player avatars will be populated here -->
                </div>
            </div>
            
            <div class="game-area">
                <div class="player-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="playerTime">00:00</div>
                        <div class="stat-label">الوقت / Time</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="playerPoints">0/20</div>
                        <div class="stat-label">النقاط / Points</div>
                    </div>
                </div>
                
                <div class="challenges-grid" id="challengesGrid">
                    <!-- Challenges will be populated here -->
                </div>
                
                <button class="finish-btn" onclick="finishGame()" id="finishBtn" style="display: none;">
                    إنهاء اللعبة / Finish Game
                </button>
            </div>
        </div>
    </div>

    <!-- Results Page -->
    <div class="page" id="resultsPage">
        <div class="results-container">
            <h2 class="results-title">
                لائحة النتائج<br>
                List of Results
            </h2>
            
            <div class="results-grid" id="resultsGrid">
                <!-- Results will be populated here -->
            </div>
            
            <div class="final-note" id="finalNote">
                هذه هي النتائج الحالية (قد تتغير مع انتهاء بقية اللاعبين)<br>
                 These are the current results (they may change as more players finish).
            </div>
        </div>
    </div>

    <script>
        // Game configuration - NOTE: Modify these objects to add/change players and game settings
        const GAME_CONFIG = {
            // NOTE: Set game duration in hours (24 for 24 hours)
            gameDurationHours: 24,

            const SHEET_URL = "https://script.google.com/macros/s/AKfycbxTnl0GuX1vzmQRPfOfhLoZktLMHIpT-aCRDJx-lmmeP1Vd_XuQViEyQ_bTK-lN2GlP/exec"; 
// Save result
async function saveResult(playerCode, playerData) {
    await fetch(SHEET_URL, {
        method: "POST",
        body: JSON.stringify({
            Code: playerCode,
            Name: playerData.name,
            Avatar: playerData.avatar,
            Points: playerData.points,
            Time: playerData.time
        })
    });
}

// Load results
async function loadResults() {
    const res = await fetch(SHEET_URL);
    let resultsArray = await res.json();

    // Sort: highest points first, then fastest time
    resultsArray.sort((a, b) => b.Points - a.Points || a.Time - b.Time);

    renderResultsList(resultsArray);
}
        };

        // Game state
        let gameState = {
            currentPlayer: null,
            startTime: null,
            endTime: null,
            currentPoints: 0,
            completedChallenges: new Set(),
            gameStarted: Date.now(), // NOTE: Change this to set when the game period starts
            gameExpired: false
        };

        // Load or initialize results from memory
        let gameResults = JSON.parse(localStorage.getItem('gameResults') || '{}');

        // Challenges data - NOTE: Modify these to change game content
        const challenges = [
            {
                id: 'quiz1',
                type: 'quiz',
                title: 'التحدي الأول / 1st Challenge',
                question: 'ما هي عاصمة المملكة العربية السعودية؟ / What is the capital of Saudi Arabia?',
                options: [
                    'الرياض / Riyadh',
                    'جدة / Jeddah', 
                    'مكة / Makkah',
                    'القصيم / Alkaseem'
                ],
                correct: 0,
                points: 5
            },
            {
                id: 'quiz2',
                type: 'quiz',
                title: 'التحدي الثاني / 2nd Challenge',
                question: 'كم عدد أيام السنة؟ / How many days are in a year?',
                options: [
                    '364',
                    '365',
                    '366',
                    '367'
                ],
                correct: 1,
                points: 5
            },
            {
                id: 'math1',
                type: 'math',
                title: 'التحدي الثالث / 3rd Challenge',
                question: '15 + 27 = ?',
                answer: 42,
                points: 3
            },
            {
                id: 'math2',
                type: 'math',
                title: 'التحدي الرابع / 4th Challenge', 
                question: '8 × 7 = ?',
                answer: 56,
                points: 3
            },
           // {
            //    id: 'maze1',
            //    type: 'maze',
           //     title: 'التحدي الخامس / 5th Challenge',
            //    question: 'اعثر على الطريق من البداية إلى النهاية / Find the path from start to end',
             //   maze: [
             //       [1, 0, 0, 0, 0],
            //        [1, 1, 0, 1, 0],
             //       [0, 1, 1, 1, 0],
           //         [0, 0, 0, 1, 1],
           //         [0, 0, 0, 0, 2]
           //     ],
           //     correctPath: [[0,0], [1,0], [1,1], [2,1], [2,2], [2,3], [3,3], [3,4], [4,4]],
           //     points: 4
          //  }
        
        ];

        // Initialize the game
        function initGame() {
            checkGameExpiry();
            populateOtherPlayers();
            renderChallenges();
            
            if (!gameState.gameExpired) {
                startTimer();
            }
        }

        function checkGameExpiry() {
            const now = Date.now();
            const gameEnd = gameState.gameStarted + (GAME_CONFIG.gameDurationHours * 60 * 60 * 1000);
            gameState.gameExpired = now > gameEnd;
        }

async function startGame() {
    const code = document.getElementById('playerCode').value.trim();

    if (!code || code.length !== 4) {
        alert('يرجى إدخال كود صحيح من 4 أرقام / Please enter a valid 4-digit code');
        return;
    }

    // Load players from Google Sheet
    const res = await fetch(SHEET_URL);
    const rows = await res.json();

    // Find player by Code
    const playerRow = rows.find(r => String(r.Code).trim() === code);

    if (!playerRow) {
        alert('كود غير صحيح / Invalid code');
        return;
    }

    // If already finished → jump to results
    if (playerRow.Points && playerRow.Time) {
        showResults();
        return;
    }

    // Otherwise → set up current player
    gameState.currentPlayer = {
        code,
        name: playerRow.Name || 'Player',
        avatar: playerRow.Avatar || '🙂'
    };
    gameState.startTime = Date.now();

    // Switch to the game page
    document.getElementById('introPage').classList.remove('active');
    document.getElementById('gamePage').classList.add('active');

    initGame();
}


        function populateOtherPlayers() {
            const container = document.getElementById('otherPlayers');
            container.innerHTML = '';
            
            // Set current player avatar
            document.getElementById('currentPlayerAvatar').textContent = gameState.currentPlayer.avatar;
            
            // Add other players (excluding current player)
            Object.values(GAME_CONFIG.players).forEach(player => {
                if (player !== gameState.currentPlayer) {
                    const avatar = document.createElement('div');
                    avatar.className = 'player-avatar';
                    avatar.textContent = player.avatar;
                    container.appendChild(avatar);
                }
            });
        }

        function renderChallenges() {
            const container = document.getElementById('challengesGrid');
            container.innerHTML = '';
            
            challenges.forEach(challenge => {
                const card = createChallengeCard(challenge);
                container.appendChild(card);
            });
        }

        function createChallengeCard(challenge) {
            const card = document.createElement('div');
            card.className = 'challenge-card';
            card.dataset.challengeId = challenge.id;
            
            let content = `
                <div class="challenge-title">${challenge.title}</div>
                <div class="challenge-question">${challenge.question}</div>
            `;
            
            if (challenge.type === 'quiz') {
                content += '<div class="options">';
                challenge.options.forEach((option, index) => {
                    content += `<button class="option" onclick="selectOption('${challenge.id}', ${index})">${String.fromCharCode(65 + index)}. ${option}</button>`;
                });
                content += '</div>';
            } else if (challenge.type === 'math') {
                content += `<input type="number" class="math-input" id="math-${challenge.id}" placeholder="?">`;
            } else if (challenge.type === 'maze') {
                content += '<div class="maze-container" id="maze-' + challenge.id + '"></div>';
                content += '<div>اضغط على المربعات لرسم المسار / Click squares to draw path</div>';
            }
            
            content += `<button class="submit-btn" onclick="submitChallenge('${challenge.id}')">إرسال / Submit</button>`;
            
            card.innerHTML = content;
            
            if (challenge.type === 'maze') {
                setTimeout(() => renderMaze(challenge), 100);
            }
            
            return card;
        }

        function renderMaze(challenge) {
            const container = document.getElementById(`maze-${challenge.id}`);
            if (!container) return;
            
            container.innerHTML = '';
            challenge.maze.forEach((row, rowIndex) => {
                row.forEach((cell, colIndex) => {
                    const cellDiv = document.createElement('div');
                    cellDiv.className = 'maze-cell';
                    cellDiv.dataset.row = rowIndex;
                    cellDiv.dataset.col = colIndex;
                    
                    if (cell === 0) {
                        cellDiv.classList.add('wall');
                        cellDiv.textContent = '█';
                    } else if (cell === 1) {
                        cellDiv.classList.add('path');
                        cellDiv.onclick = () => toggleMazeCell(challenge.id, rowIndex, colIndex);
                    } else if (cell === 2) {
                        cellDiv.classList.add('end');
                        cellDiv.textContent = '🎯';
                    }
                    
                    if (rowIndex === 0 && colIndex === 0) {
                        cellDiv.classList.add('start');
                        cellDiv.textContent = '🟢';
                    }
                    
                    container.appendChild(cellDiv);
                });
            });
            
            // Initialize player path
            if (!challenge.playerPath) {
                challenge.playerPath = [];
            }
        }

        function toggleMazeCell(challengeId, row, col) {
            const challenge = challenges.find(c => c.id === challengeId);
            if (!challenge.playerPath) challenge.playerPath = [];
            
            const cellKey = `${row},${col}`;
            const cellDiv = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            
            if (challenge.playerPath.includes(cellKey)) {
                challenge.playerPath = challenge.playerPath.filter(p => p !== cellKey);
                cellDiv.classList.remove('selected');
            } else {
                challenge.playerPath.push(cellKey);
                cellDiv.classList.add('selected');
            }
        }

        function selectOption(challengeId, optionIndex) {
            const card = document.querySelector(`[data-challenge-id="${challengeId}"]`);
            const options = card.querySelectorAll('.option');
            
            options.forEach(option => option.classList.remove('selected'));
            options[optionIndex].classList.add('selected');
            
            const challenge = challenges.find(c => c.id === challengeId);
            challenge.selectedOption = optionIndex;
        }

        function submitChallenge(challengeId) {
            const challenge = challenges.find(c => c.id === challengeId);
            const card = document.querySelector(`[data-challenge-id="${challengeId}"]`);
            
            let correct = false;
            
            if (challenge.type === 'quiz') {
                correct = challenge.selectedOption === challenge.correct;
            } else if (challenge.type === 'math') {
                const input = document.getElementById(`math-${challengeId}`);
                correct = parseInt(input.value) === challenge.answer;
            } else if (challenge.type === 'maze') {
                if (challenge.playerPath) {
                    const pathString = challenge.correctPath.map(p => `${p[0]},${p[1]}`).join('|');
                    const playerString = challenge.playerPath.sort().join('|');
                    correct = pathString === playerString;
                }
            }
            
            if (correct) {
                gameState.currentPoints += challenge.points;
                gameState.completedChallenges.add(challengeId);
                card.classList.add('completed');
                
                // Disable further interaction
                const buttons = card.querySelectorAll('button, input');
                buttons.forEach(btn => btn.disabled = true);
                
                updatePlayerStats();
                
                // Show finish button when all challenges completed
                if (gameState.completedChallenges.size === challenges.length) {
                    document.getElementById('finishBtn').style.display = 'block';
                }
                
                alert('إجابة صحيحة! / Correct answer!');
            } else {
                alert('إجابة خاطئة، حاول مرة أخرى / Wrong answer, try again');
            }
        }

        function updatePlayerStats() {
            document.getElementById('playerPoints').textContent = `${gameState.currentPoints}/20`;
        }

        function startTimer() {
            setInterval(() => {
                if (gameState.startTime) {
                    const elapsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    document.getElementById('playerTime').textContent = 
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
            }, 1000);
        }

        function finishGame() {
            gameState.endTime = Date.now();
            const totalTime = Math.floor((gameState.endTime - gameState.startTime) / 1000);
            
            // Save results to memory (Note: In a real app, this would be saved to a server)
            saveResult(playerCode, {
    name: gameState.currentPlayer.name,
    avatar: gameState.currentPlayer.avatar,
    points: gameState.currentPoints,
    time: totalTime
});
async function showResults() {
    document.getElementById('gamePage').classList.remove('active');
    document.getElementById('resultsPage').classList.add('active');
    await loadResults();
            // NOTE: Since localStorage is not supported, results will only persist during this session
            // In a real application, you would send this data to a server
            
        }

        function showResults() {
            document.getElementById('gamePage').classList.remove('active');
            document.getElementById('resultsPage').classList.add('active');
            
            renderResults();
        }

        function createResultCard(result, isWinner, isCurrentPlayer) {
    const card = document.createElement('div');
    card.className = 'result-card';
    
    if (isWinner) card.classList.add('winner');
    if (isCurrentPlayer) card.classList.add('current-player');
    
    card.innerHTML = `
        <div class="result-avatar">${result.avatar}</div>
        <div class="result-info">
            <div class="result-name">${result.name}</div>
            <div class="result-stats">
                النقاط / Points: ${result.points} |
                الوقت / Time: ${Math.floor(result.time / 60)}:${(result.time % 60).toString().padStart(2, '0')}
            </div>
        </div>
    `;
    
    return card;
}


        function renderResultsList(resultsArray) {
    const container = document.getElementById('resultsGrid');
    container.innerHTML = '';

    const top3 = resultsArray.slice(0, 3);
    top3.forEach(result => {
        const card = createResultCard(result, true, false); // winner highlight
        container.appendChild(card);
    });

    resultsArray.slice(3).forEach(result => {
        const card = createResultCard(result, false, false);
        container.appendChild(card);
    });
}
        </script>
    </body>

</html>

